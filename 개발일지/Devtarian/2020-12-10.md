#### `2020-12-10 (목)`

<br/>

# 💻 1

## 📂1-1 ReviewForm

<br/>

> src > pages > ReviewForm.js

<br/>

### ⚡ 1-1-1

- Q ) 나중에 server에 전송하기 위해 File URL 아닌 file 자체 저장 후 UI 그릴 때 URL 추출?
- A ) Reviews state 내에 imgFiles, imageFilesURL 두개의 별도 항목 생성
```js
const onImageUpload = (e) => {
  let files = e.target.files;
  if (files.length > 5) {
    alert('최대 5장까지 선택해주세요 : )');
    return;
  }
  let fileURLs = [];
  let file;
  let filesLength = files.length > 5 ? 5 : files.length;
  for (let i = 0; i < filesLength; i++) {
    file = files[i];

    let reader = new FileReader();
    reader.onload = () => {
      fileURLs[i] = reader.result;
      setReview({
        ...review,
        imgFiles: [...files],
        imgFileURLs: [...fileURLs],
      });
    };
    reader.readAsDataURL(file);
  }
};
```

<br/>

> src > components > form > StarRating.js

<br/>

### ⚡ 1-1-2

- Q ) StarRating 구현
- A )
  1. layerX로 현재 layer를 기준으로  mouseOver event가 일어난 곳의 현재 X좌표를 구하여 현재 좌표를 통해 rate를 산출한다.
  2. overflow는 hidden시키고, 산출한 rate와 별 하나의 넓이를 곱한 값을 ratedStars의 width로 설정한다.
  3. width, svg를 변수로 설정하여 추상화한다.
```js
import React, { useState, useEffect } from 'react';
import styled from 'styled-components';
import { svg } from '../../config/config';

const ratedTextMap = {
  0.0: '평가하기',
  0.5: '최악이에요',
  1.0: '실망이에요',
  1.5: '맛없어요',
  2.0: '별로에요',
  2.5: '그냥그래요',
  3.0: '평범해요',
  3.5: '괜찮아요',
  4.0: '맛있어요',
  4.5: '훌륭해요!',
  5.0: '최고에요!',
};

const StarRating = ({ name, onReviewChange }) => {
  const [fetchedRate, setFetchedRate] = useState(0.0);
  const [rate, setRate] = useState(0);
  const starsWidth = 150;
  const oneStarWidth = starsWidth / 5;

  useEffect(() => {
    setRate(fetchedRate);
  }, [fetchedRate]);

  const handleMouseMove = (e) => {
    setRate((Math.floor((e.nativeEvent.layerX / oneStarWidth) * 2) + 1) / 2);
  };

  const handleMouseLeave = () => {
    setRate(fetchedRate || 0);
  };

  const handleClick = (e) => {
    setFetchedRate(rate);
    onReviewChange(e);
  };

  const Star = ({ isRated }) => {
    return <li className={`${isRated ? 'starRated' : 'star'}`} name={name} value={rate}></li>;
  };

  return (
    <Wrap className="wrap" rate={rate} starsW={starsWidth} oneStarW={oneStarWidth} svg={svg}>
      <h3>별점</h3>
      <div className="innerWrap">
        <ul className="stars" onMouseMove={handleMouseMove} onMouseLeave={handleMouseLeave} onClick={handleClick}>
          {[...new Array(5)].map((_, index) => (
            <Star key={index} />
          ))}
          <ul className="ratedStars">
            {[...new Array(5)].map((_, index) => (
              <Star key={index} isRated={true} />
            ))}
          </ul>
        </ul>
        <span className="text">{ratedTextMap[fetchedRate]}</span>
      </div>
    </Wrap>
  );
};

export default React.memo(StarRating);

const Wrap = styled.div`
  .innerWrap {
    position: relative;
  }
  .stars {
    width: ${(props) => props.starsW}px;
    cursor: pointer;
  }
  .ratedStars {
    position: absolute;
    top: 0;
    left: 0;
    width: ${(props) => (props.rate ? props.rate * props.oneStarW + 'px' : '0')};
    overflow: hidden;
    white-space: nowrap;
  }
  .text {
    position: absolute;
    top: 6px;
    left: 162px;
    color: ${(props) => props.theme.gray[1]};
    font-size: 14px;
  }

  .star {
    display: inline-block;
    background: ${(props) => `url(${props.svg.star})`} center center / contain no-repeat;
    vertical-align: top;
    width: ${(props) => props.oneStarW}px;
    height: ${(props) => props.oneStarW}px;
  }

  .starRated {
    display: inline-block;
    background: ${(props) => `url(${props.svg.ratedStar})`} center center / contain no-repeat;
    vertical-align: top;
    width: ${(props) => props.oneStarW}px;
    height: ${(props) => props.oneStarW}px;
  }
`;
```

### ⚡ 1-1-3

- Q ) StarRating 바뀐값이 review state에 저장이 안된다..? event 잘 넘겨받고 있고, name, value도 설정해있는데 왜..?
- A )

# 💻 2

## 📂2-1 RecentKeyword

<br/>

> src > components > search > RecentKeyword.js

<br/>

### ⚡ 2-1-1

- Q ) 최근 검색어 목록이 뜨지 않음
- A ) e.target.classList.contains 여부로 show state를 관리했었는데, styled-component에서 임의로 부여한 class명이 바뀌었기 때문에 이전의 className과 더 이상 일치하지 않게 되었기 때문이다. 처음 코드를 짤 때도 조금 불안하다 싶었는데, 문제를 일찍 발견하여 다행이다! data-show에 'show'를 부여하고, e.target.dataset.show === 'show'일 때만 show state가 true가 되도록 변경하였다.

<br/>

> src > components > search > search

<br/>

Search.js
```js
const handleShowRecentKeywords = (e) => {
  setShow(() => (e.target.dataset.show === 'show' ? true : false));
};
```

<br/>

> src > components > search > SearchForm.js

<br/>

SearchForm.js
```js
return (
  <Wrap>
    <SearchInput
      placeholder="근처의 채식 식당을 찾아보세요!"
      value={value}
      data-show="show"
      onChange={handleInputChange}></SearchInput>
    <SearchButton type="submit" data-show="show" onClick={handleInputClick}>
      검색
    </SearchButton>
  </Wrap>
);
```